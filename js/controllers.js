app.controller("projectsController",["$scope","$http",function($scope,$http){$scope.listData=[],$scope.logData=[],$scope.projects={},$http.get("./data/svn_list.json").success(function(listData){$scope.listData=listData.lists.list.entry,path=listData.lists.list._path;for(var i=0;i<$scope.listData.length;i++){var name=$scope.listData[i].name,date=$scope.listData[i].commit.date;if(name.indexOf("/")>=0&&(name=name.slice(0,name.indexOf("/"))),name in $scope.projects&&$scope.projects[name][date]<date||!(name in $scope.projects)){var newProject={};newProject.name=name,newProject.date=date,newProject.kind=$scope.listData[i]._kind,newProject.author=$scope.listData[i].commit.author,newProject.version=$scope.listData[i].commit._revision,newProject.files={},newProject.comments="",$scope.projects[name]=newProject}}for(var i=0;i<$scope.listData.length;i++){var name=$scope.listData[i].name;name.indexOf("/")>=0&&(name=name.slice(0,name.indexOf("/")));var filename=$scope.listData[i].name;filename.lastIndexOf("/")>=0&&(filename=filename.slice(filename.lastIndexOf("/")+1,filename.length));var file_version=$scope.listData[i].commit._revision;if(filename in $scope.projects[name].files){if(filename in $scope.projects[name].files)if($scope.projects[name].files[filename].Version<file_version){var newFile={};newFile.fileName=filename,newFile.Version=file_version,newFile.Size=$scope.listData[i].size,newFile.Date=$scope.listData[i].commit.date,newFile.Type="File",newFile.Author=$scope.listData[i].commit.author,newFile.msg="",newFile.Path=path+"/"+$scope.listData[i].name,newFile.PreviousVersion=$scope.projects[name].files[filename].PreviousVersion;var oldVersion=$scope.projects[name].files[filename].Version;$scope.projects[name].files[filename].PreviousVersion={},newFile.PreviousVersion[oldVersion]=$scope.projects[name].files[filename],$scope.projects[name].files[filename]=newFile}else{var newFile={};newFile.fileName=filename,newFile.Version=file_version,newFile.Date=$scope.listData[i].commit.date,newFile.Size=$scope.listData[i].size,newFile.Author=$scope.listData[i].commit.author,newFile.msg="",newFile.Type="File",newFile.Path=path+"/"+$scope.listData[i].name,newFile.PreviousVersion={},$scope.projects[name].files[filename].PreviousVersion[file_version]=newFile}}else if("size"in $scope.listData[i]){var newFile={};newFile.fileName=filename,newFile.Version=file_version,newFile.Date=$scope.listData[i].commit.date,newFile.Size=$scope.listData[i].size,newFile.Author=$scope.listData[i].commit.author,newFile.Type="File",newFile.Path=path+"/"+$scope.listData[i].name,newFile.msg="",newFile.PreviousVersion={},$scope.projects[name].files[filename]=newFile}}$http.get("./data/svn_log.json").success(function(logData){$scope.logData=logData.log.logentry;for(var i=0;i<$scope.logData.length;i++){var version=$scope.logData[i]._revision;for(var j in $scope.projects)version===$scope.projects[j].version&&($scope.projects[j].comments=$scope.logData[i].msg)}}),console.log($scope.projects)})}]);
app.controller("projectsController",["$scope","$http","$sce",function($scope,$http,$sce){function createNewFileEntry(newFile,filename,file_version,data,i){newFile.fileName=filename,newFile.Version=file_version,newFile.Date=data[i].commit.date,newFile.Size=data[i].size,newFile.msg="",newFile.Author=data[i].commit.author,data[i].name.lastIndexOf("src")>=0?newFile.Type="Src":data[i].name.lastIndexOf("png")>=0?newFile.Type="Img":newFile.Type="File",newFile.Path=path+"/"+data[i].name}$scope.listData=[],$scope.logData=[],$scope.projects={},$scope.parsedURL="",$scope.customUrl=$sce.trustAsResourceUrl("http://jsfiddle.net/478wA/"),$scope.title="",$http.get("./data/svn_list.json").success(function(listData){$scope.listData=listData.lists.list.entry,path=listData.lists.list._path,$scope.parsedURL=path,$scope.getInfo($scope.listData),$scope.addFile($scope.listData),$http.get("./data/svn_log.json").success(function(logData){$scope.logData=logData.log.logentry,$scope.matchInfo($scope.logData)}),console.log($scope.projects)}),$scope.getInfo=function(data){for(var i=0;i<data.length;i++){var name=data[i].name,date=data[i].commit.date;if(name.indexOf("/")>=0&&(name=name.slice(0,name.indexOf("/"))),name in $scope.projects&&$scope.projects[name][date]<date||!(name in $scope.projects)){var newProject={};newProject.name=name,newProject.date=date,newProject.kind=data[i]._kind,newProject.author=data[i].commit.author,newProject.version=data[i].commit._revision,newProject.files={},newProject.comments="",$scope.projects[name]=newProject}}},$scope.addFile=function(data){for(var i=0;i<data.length;i++){var name=data[i].name;name.indexOf("/")>=0&&(name=name.slice(0,name.indexOf("/")));var filename=data[i].name;filename.lastIndexOf("/")>=0&&(filename=filename.slice(filename.lastIndexOf("/")+1,filename.length));var file_version=data[i].commit._revision;if(filename in $scope.projects[name].files){if(filename in $scope.projects[name].files)if($scope.projects[name].files[filename].Version<file_version){var newFile={};createNewFileEntry(newFile,filename,file_version,data,i),newFile.PreviousVersion=$scope.projects[name].files[filename].PreviousVersion;var oldVersion=$scope.projects[name].files[filename].Version;$scope.projects[name].files[filename].PreviousVersion={},newFile.PreviousVersion[oldVersion]=$scope.projects[name].files[filename],$scope.projects[name].files[filename]=newFile}else{var newFile={};createNewFileEntry(newFile,filename,file_version,data,i),newFile.PreviousVersion={},$scope.projects[name].files[filename].PreviousVersion[file_version]=newFile}}else if("size"in data[i]){var newFile={};createNewFileEntry(newFile,filename,file_version,data,i),newFile.PreviousVersion={},$scope.projects[name].files[filename]=newFile}}},$scope.matchInfo=function(data){for(var i=0;i<data.length;i++){var version=data[i]._revision;for(var j in $scope.projects)version===$scope.projects[j].version&&($scope.projects[j].comments=$scope.logData[i].msg)}},$scope.setURL=function(key,name){$scope.title=name,$scope.parsedURL=key,$scope.customUrl=$sce.trustAsResourceUrl($scope.parsedURL)}}]);